---
{"dg-publish":true,"title":"ë””ìŠ¤ì½”ë“œ ë² ìŠ¤íŠ¸ í¬ìŠ¤íŠ¸ ì¶”ì²œ ë´‡ ë§Œë“¤ê¸° 6í¸ - ëª¨ë“  ê²Œì‹œê¸€ ìˆ˜ í™•ì¸ í•˜ê¸°, ìœ ì—°í•œ í™•ì¥ì„ ìœ„í•œ êµ¬ì¡° ìˆ˜ì •, ì ì ˆí•œ ìºì‹œ ì‚¬ìš©","description":null,"permalink":"/projects/library/kr/100/110/110-00/kr-110-00-f/","dgPassFrontmatter":true,"noteIcon":"0","created":"2024-12-17T14:23:18.007+09:00","updated":"2024-12-17T14:30:13.787+09:00"}
---

í˜„ì¬ ë…¸íŠ¸: [[Projects/Library/KR/100/110/110.00/KR-110.00 a\|KR-110.00 a]]  ë””ìŠ¤ì½”ë“œ ë² ìŠ¤íŠ¸ í¬ìŠ¤íŠ¸ ì¶”ì²œ ë´‡ ë§Œë“¤ê¸° 6í¸ - ëª¨ë“  ê²Œì‹œê¸€ ìˆ˜ í™•ì¸ í•˜ê¸°, ìœ ì—°í•œ í™•ì¥ì„ ìœ„í•œ êµ¬ì¡° ìˆ˜ì •, ì ì ˆí•œ ìºì‹œ ì‚¬ìš©
ìƒìœ„ ë¶„ë¥˜: [[Projects/Library/KR/100/110/110.00/KR-110.00\|KR-110.00]] ë””ìŠ¤ì½”ë“œ ë² ìŠ¤íŠ¸ í¬ìŠ¤íŠ¸ ì¶”ì²œ ë´‡ ì œì‘ê¸°


#í”„ë¡œì íŠ¸ê²½í—˜ #ê°œì¸í”„ë¡œì íŠ¸ #ë””ìŠ¤ì½”ë“œë´‡

# ë””ìŠ¤ì½”ë“œ ë² ìŠ¤íŠ¸ í¬ìŠ¤íŠ¸ ì¶”ì²œ ë´‡ ë§Œë“¤ê¸° 6í¸ - ëª¨ë“  ê²Œì‹œê¸€ ìˆ˜ í™•ì¸ í•˜ê¸°, ìœ ì—°í•œ í™•ì¥ì„ ìœ„í•œ êµ¬ì¡° ìˆ˜ì •, ì ì ˆí•œ ìºì‹œ ì‚¬ìš©

ë³¸ ê¸€ì˜ ë‚´ìš©ì€ ì¼ë°˜ì ìœ¼ë¡œ  ë‹¤ìŒê³¼ ê°™ì€ íë¦„ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.
ì›í•˜ëŠ” ê²ƒì„ êµ¬í˜„ ì‹œë„ -> ë¬¸ì œê°€ ìƒê¹€ -> í•´ê²°
ë˜ë‹¤ë¥¸ ê¸°ëŠ¥ë“± ì‹œë„-> ë‹¤ì‹œ ìƒˆë¡œìš´ ë¬¸ì œê°€ ìƒê¹€ -> í•´ê²°
... êµ¬í˜„ ë˜ëŠ” ìˆ˜ì •ì´ë‚˜ í•´ê²°ë  ë•Œê¹Œì§€ ì ì ˆí•˜ê²Œ ë°˜ë³µ


**ê²°ë¡ **
ëª¨ë“  ê²Œì‹œê¸€ì„ í™•ì¸í•˜ëŠ ê³¼ì •ì—ì„œ ê³¼ê±°ì™€ëŠ” ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ê¸°ëŠì‘ã„¹ ì¶”ê°€í•¨. ì´ì „ì—ëŠ” ëª…í™•í•œ íŒŒì¼ê³¼, êµ¬ì¡°ê°€ ì •í•´ì§„ jsoníŒŒì¼ì„ ì´ìš©í–ˆëŠ”ë° ì´ëŠ” í™•ì¥ê³¼ ìˆ˜ì •ë“±ì— ìˆì–´ì„œ í° ì–´ë ¤ì›€ì´ìˆì—ˆìŠ´. ê·¸ë˜ì„œ ì´ë²ˆì—ëŠ” ë©”ëª¨ë¦¬ìƒì— ë¨¼ì € ì˜¬ë ¤ì„œ ì²˜ë¦¬í•˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„
í•˜ì§€ë§Œ ì´ëŸ°ê²½ìš° ì•½ 1700ê°œì˜ ë©”ì‹œì§€ê°€ ë˜ëŠ” ìˆœê°„ fetchì— 5ë¶„ì •ë„ê°€ ê±¸ë ¤ë²„ë¦¼. ê·¸ë˜ì„œ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ë˜, í•´ë‹¹ ë‚´ìš©ì„ writeí•´ì„œ jsonìœ¼ë¡œ ë§Œë“ í›„ ì´ë¥¼ ìºì‹œì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•¨.

ì´ì „ ì €ì¥ ê¸°ëŠ¥ + ì»¤ë§¨ë“œ ê¸°ëŠ¥ -> í˜„ì¬ ì»¤ë§¨ë“œê¸°ëŠ¥


# ê²Œì‹œê¸€ ì´í•© ê¸°ëŠ¥
1. ì±„ë„ë³„ ê²Œì‹œê¸€ ì´ ìˆ˜
	1. ê¸°ì¡´ì˜ active ê²Œì‹œê¸€
	2. ì¶”ê°€ archive ê²Œì‹œê¸€
2. ì´ ê²Œì‹œê¸€ ìˆ˜
ê¸°ì¡´ì˜ jsoníŒŒì¼ ì´ìš©ë°©ì‹ëŒ€ì‹  ë©”ëª¨ë¦¬ ì •ë³´ ì‚¬ìš©. ì‰½ê²Œ í™•ì¥ ê°€ëŠ¥
ë‹¨ì ì€ ëŠë ¤ì§


# ë””ìŠ¤ì½”ë“œ ì»¤ë§¨ë“œ ë“±ë¡ ì•ˆë¨
global command updateì˜ ê²½ìš° 1ì‹œê°„ì´ ê¸°ë³¸ì¼ ìˆ˜ ìˆë‹¤ê³ í•¨.
docs ê²€ìƒ‰-> reloadë¼ëŠ” ì¦‰ì‹œ ë°˜ì˜ ê¸°ëŠ¥ í™•ì¸

```
        await rest.put(
          Routes.applicationCommands(
            process.env.CLIENT_ID,
            // ì—†ì—ˆìŒ process.env.GUILD_ID
          ),
          { body: commands }
        );
```

ì™ ì§€ ëª¨ë¥´ê² ì§€ë§Œ ë””ìŠ¤ì½”ë“œë´‡ì´ ìˆëŠ” í•´ë‹¹ ì±„ë„ì—ì„œ `ctrl+R` í•˜ë‹ˆê¹ ë°”ë¡œ ë°˜ì˜ë¨
ì¶œì²˜: https://www.wikihow.com/Refresh-Discord#:~:text=You%20may%20also%20press%20Ctrl,on%20Mac%20to%20refresh%20Discord.&text=On%20Android%2C%20try%20force%20stopping%20the%20Discord%20app%20to%20refresh%20it.



# ì‘ë‹µ ê²°ê³¼ ìºì‹± í•„ìš”
ëª¨ë“  ë©”ì‹œì§€ë° ì´ëª¨ì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ”ë° ì•½ 4ë¶„ì´ ê±¸ë¦¼.
í•´ë‹¹ ë°ì´í„°JSONíŒŒì¼ë¡œ ìƒì„±í›„ ì²˜ë¦¬í•  í•„ìš”ê°€ ìƒê¹€

#  ì»¤ë§¨ë“œê°€ ì§„í–‰ë˜ëŠ” ë™ì•ˆ ë©”ì‹œì§€ í‘œì‹œ

`await interaction.deferReply({content: "ì¼ì¤„ì¼ ì•ˆì— ìºì‹±ëœ ë°ì´í„° í™•ì¸ì¤‘ì…ë‹ˆë‹¤..."});`

3ì´ˆì´ìƒ ê±¸ë¦¬ëŠ” ë©”ì‹œì§€ì— í•œí•´ ì ìš© ê°€ëŠ¥

ìˆ˜ë™ìœ¼ë¡œ 1ë²ˆ ë°ì´í„° JSONìœ¼ë¡œ ìºì‹±

- ì»¤ë§¨ë“œë¡œë”©í•˜ëŠ” ë™ì•ˆ ìºì‹±ì¤‘ì¸ ë°ì´í„° í™•ì¸ì¤‘ì´ë¼ëŠ” ë©”ì‹œì§€ í‘œì‹œ
- ë°ì´í„° ìºì‹±í•´ì„œ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ `JSON.parse` í•´ì„œ ì‚¬ìš©. ì—†ìœ¼ë©´ fetchí•´ì„œ ì•½ 4ë¶„ ë™ì•ˆ ì‚¬ìš©í•œí›„, write


# ìºì‹± ì¦‰ fetchí• ì§€ ë§ì§€ë¥¼ Y/Nìœ¼ë¡œ ì…ë ¥ë°›ê¸°
ë²„íŠ¼ ì¶”ê°€ë¥¼ í†µí•´ cacheê¸°ëŠ¥ì˜ ì‚¬ìš©ì—ëŒ€í•œ ì„ íƒì§€ë¥¼ ì¶”ê°€. ì´ì „ì—ëŠ” ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¬´ì¡°ê±´ fetchìˆ˜í–‰ì´ì—ˆìŒ

# ë””ìŠ¤ì½”ë“œ snowflacktime ê¸°ë°˜ìœ¼ë¡œ ëª…ë ¹ì–´ ì—…ë°ì´íŠ¸ëœ ì‹œê°„ í™•ì¸
[ë§í¬](https://snowsta.mp/)
ê°„ë‹¨ ì„¤ëª… discordì—ì„œ ì‚¬ìš©ë˜ëŠ” ê³ ìœ  íƒ€ì„ìŠ¤íƒ¬í”„
- Discord ëª…ë ¹ì–´ ID(version)ëŠ” Snowflakeë¼ëŠ” ê³ ìœ  ì‹ë³„ì í˜•ì‹ì„.
- SnowflakeëŠ” Discordì—ì„œ ì‹œê°„ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë˜ëŠ” 64ë¹„íŠ¸ ID.
- Snowflakeë¥¼ ë³€í™˜í•˜ë©´ ëª…ë ¹ì–´ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ ì—…ë°ì´íŠ¸ëœ ëŒ€ëµì  ì‹œê°„ í™•ì¸ ê°€ëŠ¥.



# ìºì‹± íŒŒì¼ ê²½ë¡œ ë¬¸ì œ
ë´‡ì´ ì‹¤í–‰ë˜ëŠ” main.jsì¸ì¤„ ì•Œì•˜ëŠ”ë°, ì»¤ë§¨ë“œê°€ ì‹¤í–‰ë˜ëŠ” commands/archivecommand.jsì´ì˜€ìŒ
console.logë¡œ í™•ì¸
```

      console.log(
        `DATA_FILE_PATH ${DATA_FILE_PATH} \ncache ${JSON.stringify(
          cache,
          null,
          2
        )} ,cache.data ${
          cache.data
        }\nìºì‹œëœ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì•„, íŒŒì¼ ë° APIì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ì§€ í™•ì¸í•©ë‹ˆë‹¤.`
      );

```

`__dirname`ì—ì„œ `prcoess.cwd()` ë¡œ ë³€ê²½

before
`const DATA_FILE_PATH = path.join(__dirname, "data", "thread_data.json");`

after
`const DATA_FILE_PATH = path.join(process.cwd(), "data", "thread_data.json");`

# ìŠ¤ë ˆë“œë¥¼ ëŒì•„ë‹¤ë‹ˆë©´ì„œ sortê¸°ë°˜ìœ¼ë¡œ 5ê°œì˜ ìŠ¤ë ˆë“œ ì—…ë°ì´íŠ¸

```
        for (const thread of archiveThreads.values()) {
          try {
            const messages = await fetchAllMessages(thread);
            const messageCount = messages.length;
            let totalReactions = 0;
            for (const message of messages) {
              totalReactions += message.reactions.cache.reduce(
                (acc, reaction) => acc + reaction.count,
                0
              );
            }

            allPosts.push({
              channelName: channel.name,
              threadName: thread.name,
              author: thread.ownerId
                ? (await interaction.guild.members.fetch(thread.ownerId))
                    .displayName
                : "ì•Œ ìˆ˜ ì—†ìŒ",
              messageCount,
              reactionCount: totalReactions,
              threadLink: `https://discord.com/channels/${interaction.guild.id}/${thread.id}`,
              totalScore: messageCount + totalReactions,
            });
          } catch (error) {
            console.error(
              `ìŠ¤ë ˆë“œ ${thread.name} (ID: ${thread.id}) ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`,
              error
            );
            continue; // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë‹¤ìŒ ìŠ¤ë ˆë“œë¡œ ê±´ë„ˆëœ€
          }
        }
      }

      allPosts.sort((a, b) => b.totalScore - a.totalScore);
      const bestPosts = allPosts.slice(0, 5);

      jsonData.bestPosts = bestPosts;
      jsonData.lastUpdated = new Date().toISOString();

      await fs.writeFile(
        DATA_FILE_PATH,
        JSON.stringify(jsonData, null, 2),
        "utf-8"
      );
      console.log("ë°ì´í„°ë¥¼ íŒŒì¼ì— ì €ì¥í–ˆìŠµë‹ˆë‹¤.");
```

:smile

ğŸ˜
### ì—´ì •í†µê³„ ê²°ê³¼ê³¼
![](https://i.imgur.com/rrvyXI6.png)


#### ì—´ì • ê²Œì‹œê¸€ ê²°ê³¼
ì£¼ë¡œ ì¸ê¸°ê°€ ë§ì€ê²ƒì€ ì‚¬ìš©ìì˜ ìœ ë„ë¥¼ ì‰½ê²Œ ì°¸ì—¬í•˜ë©°, ê³µìœ , ìë‘ê³¼ ê°™ì€ ê¸€ë“¤ì´ ì¸ê¸°ê°€ ë§ì•˜ìŒì„ ì•Œ ìˆ˜ ìˆìŒ. ì„œë¹„ìŠ¤ ì„¤ê³„ì‹œ ì°¸ê³ ê°€ëŠ¥ëŠ¥
![](https://i.imgur.com/pCSqfqo.png)